/*! For license information please see nerthus-addon-NI.js.LICENSE.txt */
!function(){var e={399:function(e,n){"use strict";function t(e,n,t,i){for(var a=e[n++],r=1<<a,o=r+1,s=o+1,c=a+1,l=(1<<c)-1,u=0,d=0,p=0,h=e[n++],m=new Int32Array(4096),g=null;;){for(;u<16&&0!==h;)d|=e[n++]<<u,u+=8,1===h?h=e[n++]:--h;if(u<c)break;var f=d&l;if(d>>=c,u-=c,f!==r){if(f===o)break;for(var y=f<s?f:g,w=0,z=y;z>r;)z=m[z]>>8,++w;var v=z;if(p+w+(y!==f?1:0)>i)return void console.log("Warning, gif stream longer than expected.");t[p++]=v;var k=p+=w;for(y!==f&&(t[p++]=v),z=y;w--;)z=m[z],t[--k]=255&z,z>>=8;null!==g&&s<4096&&(m[s++]=g<<8|v,s>=l+1&&c<12&&(++c,l=l<<1|1)),g=f}else s=o+1,l=(1<<(c=a+1))-1,g=null}return p!==i&&console.log("Warning, gif stream shorter than expected."),t}try{n.u=function(e){var n=0;if(71!==e[n++]||73!==e[n++]||70!==e[n++]||56!==e[n++]||56!=(e[n++]+1&253)||97!==e[n++])throw new Error("Invalid GIF 87a/89a header.");var i=e[n++]|e[n++]<<8,a=e[n++]|e[n++]<<8,r=e[n++],o=r>>7,s=1<<1+(7&r);e[n++],e[n++];var c=null,l=null;o&&(c=n,l=s,n+=3*s);var u=!0,d=[],p=0,h=null,m=0,g=null;for(this.width=i,this.height=a;u&&n<e.length;)switch(e[n++]){case 33:switch(e[n++]){case 255:if(11!==e[n]||78==e[n+1]&&69==e[n+2]&&84==e[n+3]&&83==e[n+4]&&67==e[n+5]&&65==e[n+6]&&80==e[n+7]&&69==e[n+8]&&50==e[n+9]&&46==e[n+10]&&48==e[n+11]&&3==e[n+12]&&1==e[n+13]&&0==e[n+16])n+=14,g=e[n++]|e[n++]<<8,n++;else for(n+=12;;){if(!((C=e[n++])>=0))throw Error("Invalid block size");if(0===C)break;n+=C}break;case 249:if(4!==e[n++]||0!==e[n+4])throw new Error("Invalid graphics extension block.");var f=e[n++];p=e[n++]|e[n++]<<8,h=e[n++],1&f||(h=null),m=f>>2&7,n++;break;case 254:for(;;){if(!((C=e[n++])>=0))throw Error("Invalid block size");if(0===C)break;n+=C}break;default:throw new Error("Unknown graphic control label: 0x"+e[n-1].toString(16))}break;case 44:var y=e[n++]|e[n++]<<8,w=e[n++]|e[n++]<<8,z=e[n++]|e[n++]<<8,v=e[n++]|e[n++]<<8,k=e[n++],b=k>>6&1,j=1<<1+(7&k),E=c,x=l,S=!1;k>>7&&(S=!0,E=n,x=j,n+=3*j);var N=n;for(n++;;){var C;if(!((C=e[n++])>=0))throw Error("Invalid block size");if(0===C)break;n+=C}d.push({x:y,y:w,width:z,height:v,has_local_palette:S,palette_offset:E,palette_size:x,data_offset:N,data_length:n-N,transparent_index:h,interlaced:!!b,delay:p,disposal:m});break;case 59:u=!1;break;default:throw new Error("Unknown gif block: 0x"+e[n-1].toString(16))}this.numFrames=function(){return d.length},this.loopCount=function(){return g},this.frameInfo=function(e){if(e<0||e>=d.length)throw new Error("Frame index out of range.");return d[e]},this.decodeAndBlitFrameBGRA=function(n,a){var r=this.frameInfo(n),o=r.width*r.height,s=new Uint8Array(o);t(e,r.data_offset,s,o);var c=r.palette_offset,l=r.transparent_index;null===l&&(l=256);var u=r.width,d=i-u,p=u,h=4*(r.y*i+r.x),m=4*((r.y+r.height)*i+r.x),g=h,f=4*d;!0===r.interlaced&&(f+=4*i*7);for(var y=8,w=0,z=s.length;w<z;++w){var v=s[w];if(0===p&&(p=u,(g+=f)>=m&&(f=4*d+4*i*(y-1),g=h+(u+d)*(y<<1),y>>=1)),v===l)g+=4;else{var k=e[c+3*v],b=e[c+3*v+1],j=e[c+3*v+2];a[g++]=j,a[g++]=b,a[g++]=k,a[g++]=255}--p}},this.decodeAndBlitFrameRGBA=function(n,a){var r=this.frameInfo(n),o=r.width*r.height,s=new Uint8Array(o);t(e,r.data_offset,s,o);var c=r.palette_offset,l=r.transparent_index;null===l&&(l=256);var u=r.width,d=i-u,p=u,h=4*(r.y*i+r.x),m=4*((r.y+r.height)*i+r.x),g=h,f=4*d;!0===r.interlaced&&(f+=4*i*7);for(var y=8,w=0,z=s.length;w<z;++w){var v=s[w];if(0===p&&(p=u,(g+=f)>=m&&(f=4*d+4*i*(y-1),g=h+(u+d)*(y<<1),y>>=1)),v===l)g+=4;else{var k=e[c+3*v],b=e[c+3*v+1],j=e[c+3*v+2];a[g++]=k,a[g++]=b,a[g++]=j,a[g++]=255}--p}}}}catch(e){}},633:function(e,n,t){var i=t(738).default;function a(){"use strict";e.exports=a=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var n,t={},r=Object.prototype,o=r.hasOwnProperty,s=Object.defineProperty||function(e,n,t){e[n]=t.value},c="function"==typeof Symbol?Symbol:{},l=c.iterator||"@@iterator",u=c.asyncIterator||"@@asyncIterator",d=c.toStringTag||"@@toStringTag";function p(e,n,t){return Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}),e[n]}try{p({},"")}catch(n){p=function(e,n,t){return e[n]=t}}function h(e,n,t,i){var a=n&&n.prototype instanceof v?n:v,r=Object.create(a.prototype),o=new D(i||[]);return s(r,"_invoke",{value:I(e,t,o)}),r}function m(e,n,t){try{return{type:"normal",arg:e.call(n,t)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var g="suspendedStart",f="suspendedYield",y="executing",w="completed",z={};function v(){}function k(){}function b(){}var j={};p(j,l,(function(){return this}));var E=Object.getPrototypeOf,x=E&&E(E(P([])));x&&x!==r&&o.call(x,l)&&(j=x);var S=b.prototype=v.prototype=Object.create(j);function N(e){["next","throw","return"].forEach((function(n){p(e,n,(function(e){return this._invoke(n,e)}))}))}function C(e,n){function t(a,r,s,c){var l=m(e[a],e,r);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==i(d)&&o.call(d,"__await")?n.resolve(d.__await).then((function(e){t("next",e,s,c)}),(function(e){t("throw",e,s,c)})):n.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return t("throw",e,s,c)}))}c(l.arg)}var a;s(this,"_invoke",{value:function(e,i){function r(){return new n((function(n,a){t(e,i,n,a)}))}return a=a?a.then(r,r):r()}})}function I(e,t,i){var a=g;return function(r,o){if(a===y)throw Error("Generator is already running");if(a===w){if("throw"===r)throw o;return{value:n,done:!0}}for(i.method=r,i.arg=o;;){var s=i.delegate;if(s){var c=O(s,i);if(c){if(c===z)continue;return c}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(a===g)throw a=w,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);a=y;var l=m(e,t,i);if("normal"===l.type){if(a=i.done?w:f,l.arg===z)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(a=w,i.method="throw",i.arg=l.arg)}}}function O(e,t){var i=t.method,a=e.iterator[i];if(a===n)return t.delegate=null,"throw"===i&&e.iterator.return&&(t.method="return",t.arg=n,O(e,t),"throw"===t.method)||"return"!==i&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+i+"' method")),z;var r=m(a,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,z;var o=r.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,z):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,z)}function M(e){var n={tryLoc:e[0]};1 in e&&(n.catchLoc=e[1]),2 in e&&(n.finallyLoc=e[2],n.afterLoc=e[3]),this.tryEntries.push(n)}function T(e){var n=e.completion||{};n.type="normal",delete n.arg,e.completion=n}function D(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(M,this),this.reset(!0)}function P(e){if(e||""===e){var t=e[l];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,r=function t(){for(;++a<e.length;)if(o.call(e,a))return t.value=e[a],t.done=!1,t;return t.value=n,t.done=!0,t};return r.next=r}}throw new TypeError(i(e)+" is not iterable")}return k.prototype=b,s(S,"constructor",{value:b,configurable:!0}),s(b,"constructor",{value:k,configurable:!0}),k.displayName=p(b,d,"GeneratorFunction"),t.isGeneratorFunction=function(e){var n="function"==typeof e&&e.constructor;return!!n&&(n===k||"GeneratorFunction"===(n.displayName||n.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,p(e,d,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},N(C.prototype),p(C.prototype,u,(function(){return this})),t.AsyncIterator=C,t.async=function(e,n,i,a,r){void 0===r&&(r=Promise);var o=new C(h(e,n,i,a),r);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},N(S),p(S,d,"Generator"),p(S,l,(function(){return this})),p(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var n=Object(e),t=[];for(var i in n)t.push(i);return t.reverse(),function e(){for(;t.length;){var i=t.pop();if(i in n)return e.value=i,e.done=!1,e}return e.done=!0,e}},t.values=P,D.prototype={constructor:D,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(i,a){return s.type="throw",s.arg=e,t.next=i,a&&(t.method="next",t.arg=n),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var r=this.tryEntries[a],s=r.completion;if("root"===r.tryLoc)return i("end");if(r.tryLoc<=this.prev){var c=o.call(r,"catchLoc"),l=o.call(r,"finallyLoc");if(c&&l){if(this.prev<r.catchLoc)return i(r.catchLoc,!0);if(this.prev<r.finallyLoc)return i(r.finallyLoc)}else if(c){if(this.prev<r.catchLoc)return i(r.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return i(r.finallyLoc)}}}},abrupt:function(e,n){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=n&&n<=a.finallyLoc&&(a=null);var r=a?a.completion:{};return r.type=e,r.arg=n,a?(this.method="next",this.next=a.finallyLoc,z):this.complete(r)},complete:function(e,n){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&n&&(this.next=n),z},finish:function(e){for(var n=this.tryEntries.length-1;n>=0;--n){var t=this.tryEntries[n];if(t.finallyLoc===e)return this.complete(t.completion,t.afterLoc),T(t),z}},catch:function(e){for(var n=this.tryEntries.length-1;n>=0;--n){var t=this.tryEntries[n];if(t.tryLoc===e){var i=t.completion;if("throw"===i.type){var a=i.arg;T(t)}return a}}throw Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:P(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=n),z}},t}e.exports=a,e.exports.__esModule=!0,e.exports.default=e.exports},738:function(e){function n(t){return e.exports=n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,n(t)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports},756:function(e,n,t){var i=t(633)();e.exports=i;try{regeneratorRuntime=i}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=i:Function("r","regeneratorRuntime = r")(i)}}},n={};function t(i){var a=n[i];if(void 0!==a)return a.exports;var r=n[i]={exports:{}};return e[i](r,r.exports,t),r.exports}t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,{a:n}),n},t.d=function(e,n){for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},function(){"use strict";$('<style id="nerthus-additional-styles">').appendTo("head");var e=JSON.parse('{"spring":{},"summer":{},"autumn":{},"winter":{"1":"#res/img/maps/Ithan - zima.optimized.png","2":"/obrazki/miasta/zima-torneg.2.png","9":"#res/img/maps/Werbin - zima 2.optimized.png","33":"/obrazki/miasta/zima-eder.png","35":"/obrazki/miasta/zima-karka-han.png","114":"/obrazki/miasta/zima-thuzal.2.png","257":"/obrazki/miasta/zima-mythar.png","574":"/obrazki/miasta/zima-nithal.png"},"default":{"1":"#res/img/maps/Ithan.png","2":"#res/img/maps/Torneg.png","8":"#res/img/maps/Zniszczone Opactwo.png","9":"#res/img/maps/Werbin - po oblężeniu 2.png","11":"#res/img/maps/Dolina Yss - tartak.png","12":"#res/img/maps/Stare Ruiny.png","37":"#res/img/maps/Brama Północy.png","121":"#res/img/maps/Góry Zrębowe.png","167":"#res/img/maps/Przeklęty Zamek - wejście południowe.png","168":"#res/img/maps/Przeklęty Zamek - wejście północne.png","169":"#res/img/maps/Przeklęty Zamek - wejście wschodnie.png","170":"#res/img/maps/Przeklęty Zamek - podziemia północne.png","171":"#res/img/maps/Przeklęty Zamek - podziemia południowe.png","172":"#res/img/maps/Przeklęty Zamek - zbrojownia.png","174":"#res/img/maps/Przeklęty Zamek - sala zgromadzeń.png","175":"#res/img/maps/Przeklęty Zamek p.1.png","222":"#res/img/maps/Zasłonięte Jezioro.png","224":"#res/img/maps/Kamienne Lokum.png","290":"#res/img/maps/Opactwo.png","291":"#res/img/maps/Opactwo p.1.png","292":"#res/img/maps/Opactwo - piwnica.png","368":"#res/img/maps/Zatopiony Szczyt.min.png","600":"#res/img/maps/Nizina Wieśniaków.png","707":"#res/img/maps/Ruiny Szabrowników.min.png","730":"#res/img/maps/Zachodnia Rubież.png","864":"#res/img/maps/Akademia wojskowa - piwnica p.2.png","866":"#res/img/maps/Cytadela p.1.png","948":"#res/img/maps/Gabinet Zireath p.1.png","1045":"#res/img/maps/Gabinet Zireath.png","1108":"#res/img/maps/Leśna Przełęcz.min.png","1233":"#res/img/maps/Wioska Rybacka.png","1263":"#res/img/maps/Tygrysia Polana.min.png","1945":"#res/img/maps/Werbin - Opuszczony dom.png","1975":"#res/img/maps/Wrzosowiska - cmentarz.png","2070":"#res/img/maps/Werbin - Mury - skrzydło zachodnie.png","2071":"#res/img/maps/Werbin - Mury - skrzydło północne.png","2072":"#res/img/maps/Werbin - Mury - skrzydło wschodnie.png","2546":"#res/img/maps/Nekropolia Karka-han.png","3246":"#res/img/maps/Zapomniana kopalnia p.1.png","3247":"#res/img/maps/Zapomniana kopalnia p.2.png","3248":"#res/img/maps/Zapomniana kopalnia p.3.png","3741":"#res/img/maps/Przeklęty Zamek p.2.png","3742":"#res/img/maps/Przeklęty Zamek - komnata.png","4764":"#res/img/maps/Włości rodu Kruzo.png"}}'),n=-1,i=[];function a(e,t){-1!==n&&e(t),i.push([e,t])}function r(e,n){Engine.npcs.check()[n]=e}function o(e){delete Engine.npcs.check()[e]}var s=Object.freeze({SPRING:"spring",SUMMER:"summer",AUTUMN:"autumn",WINTER:"winter"}),c=JSON.parse('{"_":[3459,3969,4999,6466],"l":[1862,2391]}');function l(e,n){return 5e7+1e3*e+n}function u(e){return e.startsWith("/")&&(e="https://micc.garmory-cdn.cloud"+e),e.replace(/^#/,"https://cdn.jsdelivr.net/gh/nerthus-margonem/nerthusaddon@5.8.0/")}function d(e){return(e=(9301*e+49297)%233280)/233280}function p(){return!((0!==(e=Engine.map.d).mainid||c._.includes(e.id))&&!c.l.includes(e.id));var e}function h(e){var n=document.createElement("div");return n.innerText=e,n.innerHTML}var m,f={CUSTOM:2,CUSTOM_NO_ID:1,BASIC:0},y=new Image,w={};function z(e,n,t){switch(n){case f.CUSTOM:return void(w[t]=e);case f.CUSTOM_NO_ID:return void(m=e)}}function v(e,n){switch(e){case f.CUSTOM:return void delete w[n];case f.CUSTOM_NO_ID:return void(m="")}}function k(){var n,t,i;n=Engine.map.d.id,t=new Image,i=function(n){var t=function(){function e(e,n){var t=new Date;return t.setUTCDate(e),t.setUTCMonth(n-1),t}var n=new Date,t=e(21,3),i=e(22,6),a=e(23,9);return n>=e(22,11)?s.WINTER:n>=a?s.AUTUMN:n>=i?s.SUMMER:n>=t?s.SPRING:s.WINTER}();return e[t][n]?e[t][n]:!!e.default[n]&&e.default[n]}(n),w[n]?t.src=u(w[n]):m?t.src=u(m):i&&(t.src=u(i)),y.src=t.src}var b={night:!0,weather:!0,weatherEffects:!0,zodiac:!0,hideNpcs:!1,drunkenness:!0};function j(e,n){b[e]=n,localStorage.nerthus_options=JSON.stringify(b)}function E(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,i=Array(n);t<n;t++)i[t]=e[t];return i}var x={S:64,M:96,L:160,XL:192},S=!1,N=[];function C(e){if(b.night)for(var n in e)t=e[n].type,i=e[n].x,a=e[n].y,o=void 0,s=void 0,c=void 0,o=x[t],s=l(i,a),(c=new Image).onload=r.bind(null,function(e,n,t,i){return{draw(i){i.drawImage(e,n-Engine.map.offset[0],t-Engine.map.offset[1])},getOrder(){return 1e3},update(){},d:{},updateDATA(){},rx:(n+i/2)/32,ry:(t+i/2)/32,getFollowController(){return{checkFollowGlow:()=>!1}},getNick(){return""},getId(){return-1},drawNickOrTip(){},getKind(){return null}}}(c,i,a,o),s),c.src=function(e){return"https://cdn.jsdelivr.net/gh/nerthus-margonem/nerthusaddon@5.8.0/res/img/night-lights/"+e+".png"}(t),N.push(s);var t,i,a,o,s,c}function I(){var e,n=Engine.npcs.check(),t=function(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,n){if(e){if("string"==typeof e)return E(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?E(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,s=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return o=e.done,e},e:function(e){s=!0,r=e},f:function(){try{o||null==t.return||t.return()}finally{if(s)throw r}}}}(N);try{for(t.s();!(e=t.n()).done;)delete n[e.value]}catch(e){t.e(e)}finally{t.f()}N.splice(0,N.length),S=!1}function O(){I(),void 0!==Engine.map.d.id?([1,10,1058,1059,11,110,114,1141,115,1154,1159,12,121,122,1233,1262,128,137,138,1985,2,2020,2029,2056,2063,2064,214,222,223,226,2391,244,2520,257,262,2887,3,33,344,347,35,355,356,36,361,368,37,38,4,500,574,575,589,5986,600,630,631,632,727,730,731,8,84,845,9].includes(Engine.map.d.id)?$.getJSON("https://cdn.jsdelivr.net/gh/nerthus-margonem/nerthusaddon@5.8.0/res/configs/night-lights/"+Engine.map.d.id+".json",C):console.log("lights not loaded - no file"),S=!0):setTimeout(O,500)}var M="body",T=$(),D=[6,"top-right"],P=[],A={};function _(e){e.css({visibility:"hidden",opacity:"0"}),e.find(".default-panel").removeClass("hidden"),e.find(".settings-panel").addClass("hidden");var n=e.find("#settings-button");n.tip("Ustawienia"),n.children().attr("src","https://cdn.jsdelivr.net/gh/nerthus-margonem/nerthusaddon@5.8.0/res/img/panel/settings.png"),n.removeClass("back-to-default"),e.find(".panel-name").text("Panel Nerthusa")}function R(e,n){if(!T.parent||!T.parent(M).length){var t=A.buttonGroup(e.leftPanel),i=A.buttonGroup(e.centerPanel),a=A.buttonGroup(e.rightPanel),r=A.settings(),o=(T=$(A.panel(t,i,a,r))).find(".default-panel"),s=T.find(".settings-panel"),c=T.find(".panel-name");s.find(".top-box").append(P),T.find("#settings-button").click((function(){o.toggleClass("hidden"),s.toggleClass("hidden");var e=$(this);e.toggleClass("back-to-default"),s.hasClass("hidden")?(e.tip("Ustawienia"),e.children().attr("src","https://cdn.jsdelivr.net/gh/nerthus-margonem/nerthusaddon@5.8.0/res/img/panel/settings.png"),c.text("Panel Nerthusa")):(e.tip("Powrót"),e.children().attr("src","https://cdn.jsdelivr.net/gh/nerthus-margonem/nerthusaddon@5.8.0/res/img/panel/settings-back.png"),c.text("Panel Nerthusa - ustawienia"))})).end().find(".close-button, .cancel-button, .ok-button").click((function(){_(T)})).end().find(".save-button").click((function(){T.find(".setting-checkbox").each((function(){j(this.name,this.checked)})),message("Zapisano, odśwież stronę"),_(T)})).end().find("#light-manager-button").click((function(){_(T)})).end(),T.css({visibility:n?"hidden":"visible",opacity:0}).appendTo(M).css("opacity",n?"0":"1"),function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.draggable({handle:n,start(){(window.g?window.g.lock:window.Engine.lock).add("nerthus-panel-drag")},stop(){(window.g?window.g.lock:window.Engine.lock).remove("nerthus-panel-drag")}})}(T,".header-label-positioner"),$("[tip]",T).each((function(){var e=$(this);e.tip(e.attr("tip"))}))}}function U(){return T.parent&&T.parent(M).length?"visible"===T.css("visibility")?T.css({visibility:"hidden",opacity:"0"}):void T.css({visibility:"visible",opacity:"1"}):$.getJSON("https://cdn.jsdelivr.net/gh/nerthus-margonem/nerthusaddon@5.8.0/res/configs/panel-links.json",(e=>R(e,!1)))}function W(){if(Engine.interfaceStart&&Object.keys(Engine.widgetManager.getDefaultWidgetSet()).includes("nerthus")){var e=D,n=Engine.serverStorage.get(Engine.widgetManager.getPathToHotWidgetVersion());n&&n.nerthus&&(e=n.nerthus),Engine.widgetManager.createOneWidget("nerthus",{nerthus:e},!0,[]),Engine.widgetManager.setEnableDraggingButtonsWidget(!1)}else setTimeout(W,500)}function L(e,n,t,i){var a=b[e]?" checked":"",r=$(`\n<label class="setting-label">\n    <span class="setting-label-text" tip="${t}">${n}</span>\n    <input class="setting-checkbox" name="${e}" type="checkbox" ${a}>\n    <span class="checkbox-outline">\n        <span class="checkmark">\n        <div class="checkmark-stem"></div>\n        <div class="checkmark-kick"></div>\n    </span>\n    </span>\n</label>\n`).change((function(n){j(e,n.target.checked)})).change(i);P.push(r.get()[0])}A.button=function(e){return e.url=e.url.replace("DISCORD_URL","discord.gg"),'<a href="'+e.url+'" target="_blank" class="button" tip="'+e.name+'"><img src="https://cdn.jsdelivr.net/gh/nerthus-margonem/nerthusaddon@5.8.0/res/img/panel/'+e.icon+'" alt="'+e.name+'"></a>'},A.buttonGroup=function(e){for(var n=[],t=e.length,i=0;i<t;i++)n.push(this.button(e[i]));return n.join("")},A.settings=function(){return'<div class="top-box"></div><div class="bottom-box"><button class="button text-button save-button">Zapisz</button><button class="button text-button cancel-button">Anuluj</button></div>'},A.panel=function(e,n,t,i){return'<div id="nerthus-main-panel" class="nerthus-panel"><div class="header-label-positioner"><div class="header-label"><div class="left-decor"></div><div class="right-decor"></div><span class="panel-name">Panel Nerthusa</span></div></div><div class="close-decor"><button class="close-button" tip="Zamknij"/></div><div class="background"><div class="default-panel"><div class="top-box"><div id="button-group-left" class="button-group">'+e+'</div><div id="button-group-center" class="button-group">'+n+'</div><div id="button-group-right" class="button-group">'+t+'</div></div><div class="bottom-box"><button class="button text-button ok-button">OK</button></div></div><div class="settings-panel hidden">'+i+'</div><button id="settings-button" class="button nerthus-settings-button" tip="Ustawienia"><img src="https://cdn.jsdelivr.net/gh/nerthus-margonem/nerthusaddon@5.8.0/res/img/panel/settings.png" alt="Ustawienia"></button></div></div>'},A.icon=function(){return'<img id="nerthus-shield" src="https://cdn.jsdelivr.net/gh/nerthus-margonem/nerthusaddon@5.8.0/res/img/widget-icon.gif" tip="Nerthus" alt="Nerthus panel">'};var B=0,Z={};function G(e,n){Z[arguments.length>2&&void 0!==arguments[2]?arguments[2]:"default"]=e&&"reset"!==e?{opacity:e,color:n}:""}function F(){return p()?function(e){if(!b.night)return 0;var n,t=e.getHours();return(n=t<12?1-Math.pow(.14*t-1.29,2):1-Math.pow(.1*t-1.57,2))<.3?n=.3:n>1&&(n=1),1-n}(new Date)+B:0}function K(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F(),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#000";r(function(e,n){return{draw(t){var i=t.fillStyle;t.fillStyle=n,t.globalAlpha=e,t.fillRect(0-Engine.map.offset[0],0-Engine.map.offset[1],Engine.map.width,Engine.map.height),t.globalAlpha=1,t.fillStyle=i},getOrder(){return 950},update(){},d:{},updateDATA(){},alwaysDraw:!0,getFollowController(){return{checkFollowGlow:()=>!1}},getNick(){return""},getId(){return-1},drawNickOrTip(){},getKind(){return null}}}(e=Math.min(Math.max(0,e),1),n),l(-1,-1))}function H(){var e,n=F(),t="#000",i=(e={opacity:-1,color:"#000"},Z[Engine.map.d.id]?e=Z[Engine.map.d.id]:Z.default&&(e=Z.default),e);-1!==i.opacity&&(n=i.opacity,t=i.color),n<=.2?I():n>.2&&!S&&O(),K(n,t)}function J(e){e?e>1?e=1:e<-1&&(e=-1):e=0,B=e,H()}var Y="icon LINE_OPTION line_option",V="icon LINE_EXIT line_exit",X={};function q(e,n){var t=X[e].npcNick,i=X[e].dialog,a=ee(i[n][0]),r=function(e,n){for(var t=[],i=1;i<e.length;i++)t.push(Q(e[i],n));return t}(i[n],e);!function(e,n,t,i){Engine.communication.dispatcher.on_d(["0",n,"-1","1",t,"","2","Option","-1"]);var a=function(e,n){for(var t='<ul class="answers">',i=n.length,a=0;a<i;a++){var r=Y;"END"===n[a].to&&(r=V),t+='<li class="answer dialogue-window-answer '+r+'"><div class="'+r+'"></div><span class="answer-text">'+(a+1)+". "+n[a].text+"</span></li>"}return t+="</ul>"}(0,i),r=$(".dialogue-window");$(".npc-message",r).html(t),$(".content .inner.scroll-wrapper .scroll-pane",r).html(a),$(".content .inner.scroll-wrapper .scroll-pane .answers .answer",r).each((function(n){!function(e,n,t,i,a){t[i]&&$(e).click((function(){"END"===t[i].to?ne():q(a,t[i].to),$(".scroll-wrapper",n).trigger("update")}))}(this,r,i,n,e)}))}(e,t,a,r),Engine.lock.add("nerthus-dialog")}function Q(e,n){var t=function(e){var n=e.split("->");return{text:ee(n[0]),to:n[1]}}(e);return"END"===t.to?(t.click=ne,t.icon=V):t.to&&(t.click=function(){removeScrollbar("dlgin","talkscroll"),q(n,t.to),function(){clearInterval(g.talk.scrollCheckInterval);var e=$("#dlgin");g.talk.scrollCheckInterval=setInterval((function(){$("#talkscroll").length||e.height()<$("#dlgin .message").innerHeight()+$("#dlgin .replies").innerHeight()&&($("#dlgin").css({"margin-right":20}),addScrollbar("dlgin",490,"talkscroll"))}),100),e.height()<$("#dlgin .message").innerHeight()+$("#dlgin .replies").innerHeight()&&(e.css({"margin-right":20}),addScrollbar("dlgin",490,"talkscroll"))}(),$("#dlgin").scrollTop(0)},t.icon=Y),t}function ee(e){return e.replace("#NAME",Engine.hero.d.nick)}function ne(){Engine.dialogue.finish(),Engine.lock.remove("nerthus-dialog")}function te(e){return te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},te(e)}function ie(e,n,t){return(n=function(e){var n=function(e,n){if("object"!=te(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,"string");if("object"!=te(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==te(n)?n:n+""}(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function ae(e,n){Engine.map.col.unset(e,n,2)}function re(e,n,t){if(ke[t]&&ke[t][l(e,n)]&&delete ke[t][l(e,n)],void 0===t||t===Engine.map.d.id){var i=l(e,n),a=Engine.npcs.getById(i);a&&(a.mapColSet||(a.mapColSet=[a.d.x,a.d.y]),a.delete(),Engine.map.col.setStaticColsCache())}ae(e,n),zn("removeTemporaryNpc",{x:e,y:n,mapId:t})}var oe=t(756),se=t.n(oe),ce=t(399),le={NON_SPECIFIED:0,DO_NOT_DISPOSE:1,RESTORE_TO_BACKGROUND:2,RESTORE_TO_PREVIOUS:3};function ue(e){for(var n=new ce.u(e),t={frameDelays:[],frameData:[],frameDisposal:[],width:n.width,height:n.height},i=new Uint8ClampedArray(n.width*n.height*4),a=0;a<n.numFrames();a++){var r=n.frameInfo(a);t.frameDelays[a]=r.delay,t.frameDisposal[a]=r.disposal;var o=new Uint8ClampedArray(i);switch(n.decodeAndBlitFrameRGBA(a,o),t.frameData[a]=o,t.frameDisposal[a]){case le.NON_SPECIFIED:case le.DO_NOT_DISPOSE:i=o;break;case le.RESTORE_TO_BACKGROUND:i=new Uint8ClampedArray(o);for(var s=r.x;s<r.x+r.width;s++)for(var c=r.y;c<r.y+r.height;c++)for(var l=0;l<4;l++)i[4*s+c*n.width*4+l]=0;break;case le.RESTORE_TO_PREVIOUS:i=new Uint8ClampedArray(i)}}return t}function de(e,n){return se().async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",fetch(n).then((e=>e.arrayBuffer())).then((e=>new Uint8Array(e))).then((e=>ue(e))).then((n=>{var t=document.createElement("canvas");t.width=n.width,t.height=n.height*n.frameData.length;for(var i=t.getContext("2d"),a=0;a<n.frameData.length;a++){var r=document.createElement("canvas");r.width=n.width,r.height=n.height;var o=r.getContext("2d"),s=new ImageData(n.frameData[a],n.width,n.height);o.putImageData(s,0,0),i.drawImage(r,0,a*n.height)}e.sprite=new Image,e.sprite.src=t.toDataURL(),e.fw=n.width,e.fh=n.height,e.halffw=n.width/2,e.halffh=n.height/2,e.frameAmount=n.frameData.length,e.frames=n.frameDelays.map((e=>({delay:e}))),e.leftPosMod=e.d.type>3&&!(e.fw%64)?-16:0,4!==e.d.type&&e.updateCollider(),e.beforeOnload=function(){}})).catch((e=>console.error(`Error while fetching NPC ${n}`,e))));case 1:case"end":return t.stop()}}),null,null,null,Promise)}function pe(e,n){Object.defineProperty(e.d,"icon",{get(){return n},set(){}});var t=e.beforeOnload;e.beforeOnload=function(e,i,a){a.icon===n&&t.call(a,...arguments)},setTimeout((()=>Engine.npcs.updateData([e.d])),1)}function he(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function me(e){var n={};n[e.id]=function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?he(Object(t),!0).forEach((function(n){ie(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):he(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}({},e),n[e.id].id=Number(e.id),n[e.id].tpl=Number(e.id),n[e.id].warrior_type=e.nick?0:1;var t,i,a,r,o,s=Engine.map.col.check(e.x,e.y),c=e.icon;if(c.endsWith("gif"))if(c.startsWith("https://micc.garmory-cdn.cloud/obrazki/npc/"))n[e.id].icon={special:c.substring(43)},Engine.npcTplManager.updateData([n[e.id]]),Engine.npcs.updateData([n[e.id]]);else if(c.startsWith("https://micc.garmory-cdn.cloud/obrazki/")){var l=window.CFG.r_npath,u=/^https:\/\/micc\.garmory-cdn\.cloud\/obrazki\/(.+?)\//,d=u.exec(c);window.CFG.r_npath=`/obrazki/${d[1]}/`,n[e.id].icon={special:c.replace(u,"")},Engine.npcTplManager.updateData([n[e.id]]),Engine.npcs.updateData([n[e.id]]),window.CFG.r_npath=l}else n[e.id].icon={special:"mas/nic32x32.gif"},Engine.npcTplManager.updateData([n[e.id]]),Engine.npcs.updateData([n[e.id]]),de(Engine.npcs.getById(e.id),c);else{e.icon={special:"mas/nic32x32.gif"},n[e.id].icon=e.icon,Engine.npcTplManager.updateData([n[e.id]]),Engine.npcs.updateData([n[e.id]]),e.icon=c;var p=Engine.npcs.getById(e.id);p.staticAnimation=!0;var h=new Image;h.onload=function(){p.sprite=h;var n=p.beforeOnload;p.beforeOnload=function(){return n({img:c,frames:1,hdr:{width:h.width,height:h.height}},h,e)},p.beforeOnload()},h.src=c}return e.dialog&&(a=e.id,r=e.nick,o=e.dialog,X[a]={npcNick:r,dialog:o}),s||(e.collision?(t=e.x,i=e.y,Engine.map.col.set(t,i,2)):ae(e.x,e.y)),n}function ge(e,n){ke[n]||(ke[n]={}),ke[n][e.id]&&re(e.x,e.y,n),ke[n][e.id]=e,Engine.map.d.id===n&&me(e),zn("addTemporaryNpc",{npc:e,mapId:n})}var fe=[],ye=!1;function we(e,n){var t;ye||(ye=!0,t=Engine.miniMapController.handHeldMiniMapController.updateNpc,Engine.miniMapController.handHeldMiniMapController.updateNpc=function(e){return e=e.filter((e=>!fe.includes(e.id))),t.call(Engine.miniMapController.handHeldMiniMapController,e)}),(n||b.hideNpcs)&&(fe.includes(e)||fe.push(e),API.addCallbackToEvent("newNpc",(function n(t){t.d&&t.d.id===e&&setTimeout((()=>{API.removeCallbackFromEvent.bind(API,"newNpc",n),API.callEvent("removeNpc",t),Engine.npcs.getById(t.d.id)&&Engine.npcs.removeOne(t.d.id),Engine.emotions.removeAllFromSourceId(t.d.id)}),0)})))}function ze(e){e=e.split(":");var n=new Date;return n.setHours(e[0],e[1]||0),n}function ve(e){e=e.split(".");var n=new Date,t=e[0]||n.getDay(),i=e[1]?parseInt(e[1])-1:n.getMonth(),a=e[2]||n.getFullYear();return n.setFullYear(a,i,t),n}var ke={default:[]};function be(e,n,t,i,a,r){this.x=parseInt(e),this.y=parseInt(n),this.id=l(e,n),this.nick=i,this.type=""===this.nick?4:0,this.icon=u(t),this.update=function(){},this.actions=0,this.grp=0,this.wt=4===this.type?1:0,this.collision=a,this.dialog=r}function je(e){if(!function(e){return function(e){if(!e.time)return!0;var n=ze(e.time.split("-")[0]),t=ze(e.time.split("-")[1]),i=new Date;return n>t?n<=i||i<=t:n<=i&&i<=t}(e)&&function(e){if(!e.days)return!0;var n=(new Date).getDay();return e.days.indexOf(n)>-1}(e)&&function(e){if(!e.date)return!0;var n=ve(e.date.split("-")[0]),t=new Date,i=ve(e.date.split("-")[1]);return n>i?n<=t||t<=i:n<=t&&t<=i}(e)}(e))return 1;switch(e.type){case"delete":if(!function(e){return 0===e.lvl||e.lvl+13<Engine.hero.d.lvl}(e))return;return we(e.id,0===e.lvl);case"change":return function(e){API.addCallbackToEvent("newNpc",(function n(t){if(t.d&&t.d.id===e.id){var i=new Image;if(i.src=u(e.newUrl),i.src.endsWith("gif"))if(i.src.startsWith("https://micc.garmory-cdn.cloud/obrazki/npc/"))pe(t,i.src.substring(43));else if(i.src.startsWith("https://micc.garmory-cdn.cloud/obrazki/")){var a=window.CFG.r_npath,r=/^https:\/\/micc\.garmory-cdn\.cloud\/obrazki\/(.+?)\//.exec(i.src);window.CFG.r_npath=`/obrazki/${r[1]}/`,pe(t,i.src.substring(43)),window.CFG.r_npath=a}else de(Engine.npcs.getById(e.id),i.src);else{var o=new Image;o.src=u(e.newUrl),t.sprite=o,Object.defineProperty(t,"sprite",{get(){return o},set(){}})}setTimeout(API.removeCallbackFromEvent.bind(API,"newNpc",n),0)}}))}(e);default:var n,t=null!==(n=e.tip)&&void 0!==n?n:e.name;return me(new be(e.x,e.y,e.url,t,e.collision,e.dialog))}}function Ee(e){$.getJSON(e,(function(e){e&&e.forEach(je)}))}function xe(){var e;e=_g,window._g=function(n,t,i){var a=function(e){var n=e.match(/^talk.*id=(\d+)/);if(n){var t=n[1];if(t>=l(0,0)&&void 0!==X[t])return t}return!1}(n);if(a)return q(a,0);e(n,t,i)},a((function(){(function(){for(var e in[1,1045,11,1108,114,121,1233,1263,137,15,16,169,1838,1913,1945,1975,2,2070,2071,222,2344,2520,2546,257,2663,290,291,33,330,35,36,361,368,37,38,43,4764,574,600,707,730,8,864,9,948].includes(Engine.map.d.id)&&Ee("https://cdn.jsdelivr.net/gh/nerthus-margonem/nerthusaddon@5.8.0/res/configs/npcs/"+Engine.map.d.id+".json"),ke[Engine.map.d.id])me(ke[Engine.map.d.id][e]);ke.default.forEach(me)})(),fe.forEach(we)})),L("hideNpcs","Ukrywanie NPCów","Ukrywa NPCów ustawionych przez dodatek oraz przez specjalną komendę dostępną dla narratorów. (wymaga resetu gry)",(function(){}))}var Se=JSON.parse('{"_":[7588071],"bB":[6621324,9696571,6657578],"im":[125880,7508340,6621324,5699334,7925933,9696571,6192857,1535485,9891163,9655889],"i0":[5623545,70699,30508,2328121,345207,883090,256795,5424002,7588071,5699334]}'),Ne={DEFAULT:0,NARRATOR:1,COUNCILOR:2,NAMIESTNIK:3,SPECIAL:100};function Ce(e){return Se._.includes(e)?Ne.NAMIESTNIK:Se.bB.includes(e)?Ne.COUNCILOR:Se.im.includes(e)?Ne.NARRATOR:Se.i0.includes(e)?Ne.SPECIAL:Ne.DEFAULT}function Ie(e){return Ce(e)>Ne.DEFAULT}var Oe,Me=JSON.parse('{"Kn":{"altepetl":[3759,1137,1141,1901,1926,3597],"andarum":[1730,1387,2063,2056,180,5986,4549,4548],"cold":[198,1101,2065,2064,114,2020,2066,2055,2782,140,150,122,5987,5985,5982,1711,1712,1100],"cold-swamp":[4151,4152,2320,2324,2308,2310,2524,3402,111,5948,5293,4546,2536,4547,727,726,115,725],"desert":[1350,3081,3100,1368,3328,3326,3327,3325,3315],"karka-han":[35,1235,1084,36,1788,2546,1230,1219,901,276,900,3533,3535,3534,3738,3737],"mythar":[257,246,339,3594,3595,3596,1924],"mythar-north-forest":[3765,331,3766,268,330,332,253],"nithal":[574,575,600,730,731,845,599,1761,1675,1858,1860,1858,1876,1984,2391],"north":[226,128,1058,1975,121,151,9,37,1057,10,84,38,8,2520,2730,116,4,110,4764,355,356,357,708,712],"south":[701,3758,500,576,4185,1116,347,344,348,4155,223,222,214,33,361,4154,2762,229,244,5989,5988,5983,5984,2761],"torneg":[137,1,138,11,3,631,632,2887,579,368,12,1062,333,3300,3736,1131,3734,3735,2029,2,1111,1115,3733,1060,1108,1263,1285,3361,1267,707],"tuzmer":[1233,630,1262,1607,589,1349,1154,1167,1348,3598,1613,1159],"warm-swamp":[3136,3135,3137,3138,3209,1448,1449,1399,1458],"witches":[1293,1202,1294,1297,4049,4050,4048,4052,4051]},"Zg":{"QU":{"default":[1,1,1,1],"altepetl":[0.5,0.5,0.5,0.5],"andarum":[1.2,1.2,1.5,1.2],"cold":[1,1,1,1],"cold-swamp":[1,1,1,1],"desert":[0.5,0.5,0.5,0.5],"karka-han":[1.1,1.1,1.1,1],"mythar":[1,1,1,1],"mythar-north-forest":[1.2,1.2,1.2,1.2],"nithal":[1,1,1,1.2],"north":[1,1,1,1],"south":[0.1,0.1,0.1,0.1],"torneg":[0.9,0.9,0.9,0.9],"tuzmer":[0.5,0.5,0.5,0.5],"warm-swamp":[1,1,1,1],"witches":[1.1,1.1,1.1,1.1]},"c1":{"default":[1,1,1,1],"altepetl":[1.1,1.1,1.1,1.1],"andarum":[0.9,0.9,1.2,0.9],"cold":[1,1,1,1],"cold-swamp":[1.3,1.3,1.3,1.3],"desert":[0.5,0.5,0.5,0.7],"karka-han":[1,1,1,1],"mythar":[1.3,1,1.3,1.3],"mythar-north-forest":[1.3,1,1.3,1.3],"nithal":[0.9,0.8,0.9,0.9],"north":[1.1,1.1,1.1,1.1],"south":[1,1,1,1],"torneg":[1.1,1.1,1.1,1.1],"tuzmer":[1,1,1,1],"warm-swamp":[1.3,1.3,1.3,1.3],"witches":[0.9,0.9,0.9,0.9]},"X1":{"default":[0,0,0,0],"altepetl":[10,5,10,20],"andarum":[-20,-20,-30,-20],"cold":[-10,-10,-10,-10],"cold-swamp":[-10,-10,-10,-10],"desert":[30,30,30,20],"karka-han":[-5,0,-5,-5],"mythar":[0,0,0,5],"mythar-north-forest":[0,0,0,0],"nithal":[5,0,5,5],"north":[0,0,0,0],"south":[0,0,0,0],"torneg":[0,0,0,0],"tuzmer":[10,20,20,20],"warm-swamp":[0,0,0,0],"witches":[0,0,0,0]}},"ft":{"default":1,"altepetl":2,"andarum":3,"cold":4,"cold-swamp":5,"desert":6,"karka-han":7,"mythar":8,"mythar-north-forest":9,"nithal":10,"north":11,"south":12,"torneg":13,"tuzmer":14,"warm-swamp":15,"witches":16}}'),Te=JSON.parse('{"clear-day":["Promienie słońca intensywnie rozświetlają horyzont. Czyste, błękitne niebo koi oczy, odrywa od szarej rzeczywistości.","Słońce zawieszone na bezchmurnym niebie świeci niezwykle jasno.","Po bezchmurnym niebie wędruje słońce, otulając wszystkich swoimi ciepłymi promieniami."],"day-cloud-small":["Słońce pięknie świeci, po niebie wędrują małe obłoczki, rzucające na ziemię swe cienie. Słaby wiatr orzeźwia wędrowców.","Na niebie niewielka ilość chmurek. Promienie słoneczne bez trudu przebijają się przez nie, a cienie majestatycznie przesuwają się po ziemi.","Słońce, otuliwszy się pojedynczymi chmurkami, wypuszcza na świat swoje promienie, obdarzając go przyjemnym ciepłem."],"day-cloud-big":["Słońce skryło się pod pierzyną białych chmur, przez którą tu i ówdzie przebijają się jasne promyki. Delikatny wiatr szeleści liśćmi.","Duże, przejrzyste chmury przesuwają się leniwie po sklepieniu. Promienie słoneczne przebijają się przez obłoki. ","Złociste promienie słońca przebijają się przez śnieżnobiałe chmury. Przyjemny wiatr roznosi cudowny zapach kwiatów."],"day-rain":["Słońce częściowo skryło się za chmurami, które swoją szarością pokryły błękit nieba. Krople deszczu ociężale spadają na ziemię.","Słońce jest ledwie widoczne zza ciężkich, deszczowych chmur. Z nieba cieknie słaby deszcz.","Szare, deszczowe chmury starają się zasłonić słońce. Drobne krople deszczu rozpryskują się, opadając na zielone liście drzew."],"day-storm":["Z nieba, jak szalone, spadają kolejne krople deszczu. Niebo przeszyła jasna smuga światła, której towarzyszył potężny grzmot.","Ciężkie burzowe chmury spowijają niebo. Dojrzenie słońca przez gęsto padający deszcz i chmury graniczy niemal z cudem.","Słońce usilnie stara się przebić przez gęste, burzowe chmury. Woda deszczowa w rynnach i beczkach się już przelewa, z oddali słychać serię grzmotów."],"day-rain-with-snow":["Przez szare chmury dostrzec można jeszcze promyki słońca. Kolejnym kroplom deszczu towarzyszy śnieg. Wiatr wesoło kołysze gałęźmi drzew.","Spore zachmurzenie, rzęsiście padający deszcz, mieszający się z płatkami śniegu. Miasto oświetlane przez promienie słońca wygląda przepięknie...","Z szarych chmur zakrywających niebo wydobywa się deszcz ze śniegiem. Powietrze jest bardzo zimne, a wiatr porywisty."],"day-snow":["Mimo kilku promyków słońca, nie jest łatwo odczuć ciepło. Śnieg sypiący z nieba przykrywa doliny i miasta warstwą puchu.","Zamieć śnieżna pokrywa świat białym puchem. Mimo świecącego słońca, panuje mróz, wieją bardzo silne wiatry. Dzikie szlaki i ulice miast opustoszały.","Lekkie chmurki gęsto ścielą niebo. Promienie słoneczne przebijają się przez nie, oświetlając padający w dużej ilości śnieg."],"overcast":["Białe chmury pokrywają niebo. Wieje spokojny wiatr porywający opadłe listki drzew. Mimo braku słońca jest dość ciepło.","Błękitne niebo przyozdobiła chmara białych kłębków. Wiatr wesoło hula wśród liści i gałęzi drzew.","Na niebie brak słońca. Jedynie niewielkie chmurki szybko przemierzają sklepienie."],"rain-light":["Niebo nad krainą zrobiło się szare. Z ciemnych chmur zaczął padać deszcz, a wszelaka zwierzyna schroniła się w jaskiniach, zaś ludzie ukryli się swych domostwach.","Z pozornie małych chmurek wesoło spadają ku ziemi kropelki wody. Wiatr porywa do tańca zarówno liście drzew jak i włosy, kapelusze, płaszcze oraz kaptury podróżników.","Lekkie zachmurzenie. Słońce chowa się już za horyzontem. Deszcz siąpi z nieba."],"rain":["Istne oberwanie chmury. Szary, gęsty puch staje się przyczyną ulewnego deszczu. Porywisty wiatr kołysze drzewami.","Niebem zawładnęła szarość. Z większych i mniejszych chmur pędzą ku ziemi kolejne deszczowe krople.","Ciężkie chmury deszczowe. Z nieba gęsto spadają duże krople wody."],"storm":["Rozpętała się prawdziwa burza. Z nieba seriami spadają strugi deszczu, horyzont rozświetlają błyskawice, a opadające krople zagłuszają grzmoty.","Coraz większa ilość chmur przypływa ze wschodu krainy. Ociężałe krople spadają na ziemię. Niebo przeszyła błyskawica, a grzmot jej towarzyszący, rozległ się po całej okolicy.","Burzowe chmury, w oddali słychać grzmoty, niebo rozświetlają błyskawice. Życie mieszkańcom utrudnia ponadto ciężki deszcz i silny wiatr."],"rain-with-snow":["Z ciemnych chmur pada ulewny deszcz, któremu towarzyszą nieliczne płatki śniegu. Biały puch topnieje jeszcze przed opadnięciem na ziemię.","Z ciemnych chmur powoli opadają ku ziemi kolejne krople deszczu i płatki śniegu. Wiatr ugina drzewa, a te jakby składają pokłony, chyląc się aż do ziemi.","Wielkie, ciemne chmury zaścielają gęsto sklepienie. Z nieba leje się potężny deszcz, a gdzieniegdzie można dostrzec opadające płatki śniegu."],"snow":["Powietrze staje się bardzo zimne, woda w kałużach zamarza. Obfite opady śniegu znacznie zmniejszają pole widzenia.","Białe, pierzaste chmurki suną po niebie. Płatki śniegu wesoło wirują na wietrze, opadając powoli na ziemię.","Lekko zachmurzone niebo. Słońce już niedługo schowa się za horyzontem. Z nieba gęsto spadają białe płatki śniegu."],"snow-storm":["Burza śnieżna znęca się nad miejscową fauną i florą. Mróz, śnieg i pioruny zniechęcają ludzi do opuszczania swych ciepłych, bezpiecznych domów.","Z ciemnych chmur wariacko suną ku ziemi płatki śniegu. Jasna błyskawica od czasu do czasu przeszywa niebo. Wiatr pędzi jak szalony, choć sam nie wie dokąd. Grzmoty słychać w najgłębszych zakątkach krainy.","Ciężkie i ciemne chmury. W oddali słychać potężne grzmoty, którym towarzyszą oślepiające błyski. Brak jednak deszczu, jedynie gęsto sypiący śnieg daje się we znaki."],"clear-night":["Nastała ciepła, bezwietrzna noc. Księżyc świeci jasno, a na czystym niebie ukazują się tysiące gwiazd.","Księżyc tej nocy postanowił pokazać swe lico. Towarzyszące mu gwiazdy iskrzą wesoło na bezchmurnym niebie.","Bezchmurne, gwieździste niebo. Wysoko zawieszony księżyc jasno oświetla całą krainę."],"night-cloud-small":["Księżyc co jakiś czas ukrywa się za małymi, białymi chmurami, rozświetlając je. Wieje łagodny wiatr, który nikomu nie jest w stanie przerwać snu.","Księżyc nieśmiało wygląda zza chmurki. Ciemne niebo tu i ówdzie przyozdabiają jasne gwiazdy.","Niewielkie zachmurzenie. Księżyc jasno świeci z góry. W tle doskonale są widoczne, przy słabym zachmurzeniu, gwiazdy."],"night-cloud-big":["Niebo nawiedziły jasne chmury, za którymi sprytnie schował się księżyc i większość gwiazd. Wiatr cicho zawodzi w najskrytszych zakątkach krainy.","Duże, jasne chmury, przez które światło księżyca przebija się bez problemu, nie pozwalają dojrzeć gwiazd.","Mimo przelotnych wiatrów, noc jest pogodna. Chmury skutecznie zakrywają księżyc i wszystkie gwiazdy."],"night-rain":["Chmury zakrywają księżyc. Mocny wiatr kołysze drzewami i rzuca liśćmi. Krople deszczu bezwładnie opadają na ziemię.","Księżyc, podobnie jak gwiazdy, schował się pod pierzyną ciemnych chmur, z których spadają ku ziemi krople deszczu.","Spore zachmurzenie. Księżyc prawie niewidoczny, acz jego światło przebija się przez chmury. Siąpi deszcz."],"night-storm":["Nastała burzliwa noc. Pioruny, szum wiatru i rozbijające się o okna oraz dachy krople, mało komu pozwalają zasnąć.","Ciemne chmury skryły granat nieba. Również księżyc i gwiazdy zawieruszyły się gdzieś wśród szarości. Błyskawice przyszywające niebo niosą ze sobą kolejne grzmoty i coraz większe krople deszczu.","Ciężkie burzowe chmury wyglądają przerażająco. Ani śladu księżyca, pada za to gęsty deszcz."],"night-rain-with-snow":["Z pozornie małych chmurek spadają ku ziemi krople deszczu i śniegu. Księżyc wygląda zza przepływających białych chmur. Wiatr wesoło tańczy wśród gałęzi drzew.","Słabe zachmurzenie. Księżyc jest doskonale widoczny, gwiazdy zaś tylko w niektórych momentach. Niewielkie opady śniegu i deszczu.","Noc jest bardzo chłodna, pada ulewny deszcz ze śniegiem, tworząc wielkie kałuże."],"night-snow":["Zamieć śnieżna i mróz towarzyszą tej nocy. Wieje bardzo silny wiatr, a biały puch pokrywa całą krainę.","Księżyc, otuliwszy się pierzynką chmur, skrył się wraz z gwiazdami. Płatki śniegu wesoło tańczą na wietrze, kolejno opadając na ziemię.","Duże ilości niewielkich, jasnych chmurek. Gwiazdy na przemian pojawiają się i znikają, a z nieba gęsto sypie śnieg."]}');function De(e,n,t){return $(`<div id="' + name + '-widget" class="nerthus__widget">\n            <div class="nerthus__widget-image" ${n?`style="background-image: url(${n})"`:""}"></div>\n            <div class="nerthus__widget-desc">${t}</div>\n        </div>`).appendTo(Oe)}function Pe(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,n){if(e){if("string"==typeof e)return Ae(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Ae(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,s=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return o=e.done,e},e:function(e){s=!0,r=e},f:function(){try{o||null==t.return||t.return()}finally{if(s)throw r}}}}function Ae(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,i=Array(n);t<n;t++)i[t]=e[t];return i}var _e=["/obrazki/npc/oev/piorun1.gif","/obrazki/npc/oev/piorun2.gif","/obrazki/npc/oev/piorun3.gif"],Re=12,Ue={},We=[];function Le(e,n){e>0&&!Ue[e-1]&&(Ue[e-1]={}),Ue[e]||(Ue[e]={}),Ue[e+1]||(Ue[e+1]={});for(var t=-1;t<1;t++)for(var i=-1;i<1;i++)e+t>=0&&(Ue[e+t][n+i]=!0)}function Be(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!(t>3)){var i=e*Re,a=e*Re+Re,r=n*Re,o=n*Re+Re,s=new Date;s.setMinutes(0,0,0);var c=Number(s)+(e+1)*(n+1)*Engine.map.d.id+t,l=Math.floor(d(c)*(a+1-i))+i,u=Math.floor(d(c+1)*(o+1-r))+r;if(Ue[l]&&Ue[l][u])Be(e,n,t+1);else{var p=Math.floor(d(c+e+n)*_e.length);We.push(me(new be(l,u,_e[p],"",!1)))}}}function $e(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,n){if(e){if("string"==typeof e)return Ze(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Ze(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,s=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return o=e.done,e},e:function(e){s=!0,r=e},f:function(){try{o||null==t.return||t.return()}finally{if(s)throw r}}}}function Ze(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,i=Array(n);t<n;t++)i[t]=e[t];return i}var Ge={id:l(-1,-10),url:"https://cdn.jsdelivr.net/gh/nerthus-margonem/nerthusaddon@5.8.0/res/img/weather/rain.gif",frames:{width:0,height:0,frameData:[]},frameTime:120,cache:[],cacheMapId:-1},Fe={id:l(-1,-20),url:"https://cdn.jsdelivr.net/gh/nerthus-margonem/nerthusaddon@5.8.0/res/img/weather/snow.gif",frames:{width:0,height:0,frameData:[]},frameTime:400,cache:[],cacheMapId:-1};function Ke(e){var n,t,i,a,r,o,s,c,l=arguments;return se().async((function(u){for(;;)switch(u.prev=u.next){case 0:n=l.length>1&&void 0!==l[1]&&l[1],u.next=3;break;case 3:if(n||e.cacheMapId!==Engine.map.d.id){u.next=5;break}return u.abrupt("return",!0);case 5:if(e.cacheMapId=Engine.map.d.id,e.cache=[],e.frames.frameData.length){u.next=19;break}return u.prev=8,u.next=11,se().awrap((d=e.url,fetch(d).then((e=>e.arrayBuffer())).then((e=>new Uint8Array(e))).then((e=>ue(e)))));case 11:e.frames=u.sent,e.frameTime=10*e.frames.frameDelays[0],u.next=19;break;case 15:return u.prev=15,u.t0=u.catch(8),console.error("Error decoding gif from url while caching weather canvas: ",u.t0),u.abrupt("return",!1);case 19:t=$e(e.frames.frameData);try{for(t.s();!(i=t.n()).done;)a=i.value,(r=document.createElement("canvas")).width=Engine.map.width,r.height=Engine.map.height,o=r.getContext("2d"),s=new ImageData(a,e.frames.width,e.frames.height),(c=document.createElement("canvas")).width=e.frames.width,c.height=e.frames.height,c.getContext("2d").putImageData(s,0,0),o.fillStyle=o.createPattern(c,"repeat"),o.fillRect(0,0,Engine.map.width,Engine.map.height),e.cache.push(r)}catch(e){t.e(e)}finally{t.f()}return u.abrupt("return",!0);case 22:case"end":return u.stop()}var d}),null,null,[[8,15]],Promise)}function He(e,n){return{draw(t){var i=e.cache[Math.floor(Date.now()/e.frameTime)%e.frames.frameData.length];if(i){var a=t.globalAlpha;t.globalAlpha=n,t.drawImage(i,Math.floor(-Engine.map.offset[0]),Math.floor(-Engine.map.offset[1])),t.globalAlpha=a}},getOrder(){return 930},update(){},d:{},updateDATA(){},alwaysDraw:!0,getFollowController(){return{checkFollowGlow:()=>!1}},getNick(){return""},getId(){return-1},drawNickOrTip(){},getKind(){return null}}}function Je(e){o(Ge.id),o(Fe.id),e&&Engine.weather.onClear(),function(){var e,n=Pe(We);try{for(n.s();!(e=n.n()).done;){var t=e.value;for(var i in t)re(t[i].x,t[i].y)}}catch(e){n.e(e)}finally{n.f()}We.splice(0)}()}function Ye(e){for(var n=1,t=.21,i=[],a=new function(e){this._seed=e%2147483647,this._seed<=0&&(this._seed+=2147483646),this.next=function(){return this._seed=16807*this._seed%2147483647},this.getFloat=function(){return(this.next()-1)/2147483646}}(e=e||2019),r=0;r<256;++r)i.push(a.getFloat());return{getVal:function(e){var a=e*t,r=Math.floor(a),o=a-r,s=o*o*(3-2*o),c=r%255,l=(c+1)%255;return function(e,n,t){return e*(1-t)+n*t}(i[c],i[l],s)*n},setAmplitude:function(e){n=e},setScale:function(e){t=e}}}var Ve,Xe=Object.freeze({HUMIDITY:"humidity",CLOUDINESS:"cloudiness",TEMPERATURE:"temperature"}),qe=Object.freeze(["fish","light","latern","bat"]),Qe={[Xe.HUMIDITY]:{},[Xe.CLOUDINESS]:{},[Xe.TEMPERATURE]:{}},en={default:""};function nn(e,n){if(e||(e="default"),!Qe[n][e]){var t;switch(n){case Xe.HUMIDITY:t=42;break;case Xe.CLOUDINESS:t=666;break;case Xe.TEMPERATURE:t=2020}Qe[n][e]=new Ye(Me.ft[e]*t)}return Qe[n][e]}function tn(e){for(var n in Me.Kn)if(Me.Kn[n].indexOf(e)>=0)return n;return!1}function an(e,n,t){e[t]||(t="default");var i=new Date,a=new Date(i.getFullYear(),2,20);a>i&&a.setUTCFullYear(i.getFullYear()-1);var r=Math.ceil((i-a)/864e5),o=Math.floor(r/90),s=3===o?0:o+1;return e[t][o]*(1-(r/90-o))+e[t][s]*(r/90-o)}function rn(e,n){var t=e.getTime()/36e5,i=nn(n,Xe.CLOUDINESS).getVal(t)*an(Me.Zg.QU,0,n);return i>1?1:i}function on(e,n){var t=e.getTime()/36e5,i=nn(n,Xe.HUMIDITY).getVal(t)*an(Me.Zg.c1,0,n);return i>1?1:i}function sn(e,n){return function(e,n){var t=e.getUTCMonth()+e.getUTCDate()/31,i=15*Math.sin(.52*t-1.5)+9,a=e.getTime()/36e5;return i+(10*nn(n,Xe.TEMPERATURE).getVal(a)-5)}(e,n)+an(Me.Zg.X1,0,n)}var cn=[["clear-day","day-cloud-small","day-cloud-big","overcast"],["clear-day","day-cloud-small","day-cloud-big","rain-light"],["clear-day","day-cloud-small","day-rain","rain"],["clear-day","day-rain","day-storm","storm"]],ln={"rain-light":.5,"day-rain":.6,"day-rain-with-snow":.6,"rain-with-snow":.8,"day-storm":1,rain:.9,storm:1},un={"day-snow":1,"day-rain-with-snow":1,"rain-with-snow":1,snow:1,"snow-storm":1},dn={"day-cloud-small":.1,"rain-light":.1,"day-cloud-big":.15,"day-rain":.15,rain:.15,"day-storm":.15,overcast:.2,storm:.2},pn={storm:!0,"day-storm":!0,"snow-storm":!0};function hn(){var e="";return en.default&&(e=en.default),en[Engine.map.d.id]&&(e=en[Engine.map.d.id]),e}function mn(e){var n=function(e){if(!p())return!1;var n,t=0,i=0,a=0,r=[],o=[];for(var s in Engine.map.gateways.townnames){var c=tn(s=parseInt(s));c&&o.indexOf(s)<0&&(r.push(c),o.push(s))}n=tn(Engine.map.d.id);var l=0,u=0,d=0,h=r.length;if(0===h&&!n)return!1;if(h>0){for(var m=0;m<h;m++)l+=on(e,r[m]),u+=rn(e,r[m]),d+=sn(e,r[m]);l/=h,u/=h,d/=h,n?(t=.5*on(e,n)+.5*l,i=.5*rn(e,n)+.5*u,a=.5*sn(e,n)+.5*d):(t=l,i=u,a=d)}else t=on(e,n),i=rn(e,n),a=sn(e,n);return{[Xe.HUMIDITY]:t,[Xe.CLOUDINESS]:i,[Xe.TEMPERATURE]:a}}(e);if(n){var t,i;n.temperature>25&&(n.cloudiness*=.8,n.humidity*=.8),t=n.cloudiness<=.2?0:n.cloudiness<=.55?1:n.cloudiness<=.7?2:3,i=n.humidity<=.25?0:n.humidity<=.5?1:n.humidity<=.75?2:3;var a=cn[t][i];n.temperature<-3?a=a.replace(/^rain(-light)?$/,"snow").replace(/^storm$/,"snow-storm").replace(/^day-storm$/,"day-snow"):n.temperature<5&&(a=a.replace(/^rain(-light)?$/,"rain-with-snow").replace(/^day-storm$/,"day-rain-with-snow"));var r=0;ln[a]&&(r=ln[a]);var o=0;return un[a]&&(o=un[a]),(e.getHours()<6||e.getHours()>20)&&(a=a.replace("day","night")),{name:a,rainStrength:r,snowStrength:o,temperature:n.temperature,humidity:n.humidity,cloudiness:n.cloudiness}}return{name:"indoor"}}function gn(){var e,n,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:mn(new Date).name,i=hn();if(i?(t=i,b.weatherEffects&&Je(!0)):b.weatherEffects&&Je(),"indoor"===t)Ve.css("display","none"),J(0);else if(qe.includes(t))Ve.css("display","none"),J(0),b.weatherEffects&&(n=(e=t).charAt(0).toUpperCase()+e.slice(1),Engine.weather.setMapSize(),Engine.weather.mapSize&&Engine.weather.createObjects(n,{}));else{if(b.weather&&(Ve.css("display","flex"),Ve.children(".nerthus__widget-image").css("background-image","url(https://cdn.jsdelivr.net/gh/nerthus-margonem/nerthusaddon@5.8.0/res/img/weather/icons/"+t+".png)"),Te[t])){var a=Math.floor(Math.random()*Te[t].length);Ve.children(".nerthus__widget-desc").text(Te[t][a])}if(b.weatherEffects){var o=t.replace("night","day");p()&&(ln[o]&&function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;Ke(Ge),r(He(Ge,e),Ge.id)}(ln[o]),un[o]&&function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;Ke(Fe),r(He(Fe,e),Fe.id)}(un[o]),pn[o]&&function(){!function(){Ue={};var e,n=Pe(Engine.npcs.getDrawableList());try{for(n.s();!(e=n.n()).done;){var t=e.value;t.d&&!isNaN(t.d.x)&&Le(t.d.x,t.d.y)}}catch(e){n.e(e)}finally{n.f()}if(ke[Engine.map.d.id])for(var i in ke[Engine.map.d.id])Le(ke[Engine.map.d.id][i].x,ke[Engine.map.d.id][i].y);var a,r=Pe(ke.default);try{for(r.s();!(a=r.n()).done;){var o=a.value;Le(o.x,o.y)}}catch(e){r.e(e)}finally{r.f()}}();var e={};e.x=Math.floor(Engine.map.d.x/Re),e.y=Math.floor(Engine.map.d.y/Re);for(var n=0;n<e.x;n++)for(var t=0;t<e.y;t++)Be(n,t)}()),J(dn[o])}}zn("displayWeather",t)}function fn(){var e=new Date,n=Math.floor(e.getUTCHours()+1);e.setUTCHours(n,0,0);var t=e-new Date;setTimeout((function(){gn(),fn()}),t)}function yn(){Ve=De(),b.weather||Ve.css("display","none"),a(gn),fn(),L("weather","Widget pogody","Pokazuje lub ukrywa widget w lewym górnym rogu mapy.",(function(){b.weather||Ve.css("display","none"),gn()})),L("weatherEffects","Efekty pogodowe","Pokazuje lub ukrywa efekty pogodowe z dodatku.",(function(){b.weatherEffects||J(0),Je(""!==hn()),gn()}))}var wn={};function zn(e,n){for(var t in wn[e])wn[e][t](n)}var vn=0,kn=null;function bn(){vn--,localStorage.setItem("nerthus-intoxication-lvl",vn),vn<1&&(vn=0,clearInterval(kn),kn=null)}function jn(e,n){var t=0;void 0===n&&(n=0),[".",",","?","!"].lastIndexOf(e[e.length-1])>-1&&(t=1);for(var i=e.length-1-n-t;i>0+n;i--){var a=Math.floor(Math.random()*(i+1-n)+n),r=e[i];e[i]=e[a],e[a]=r}return e}var En={},xn={};function Sn(){var e;e=Engine.chatController.addMessage,Engine.chatController.addMessage=function(n){return function(e){var n,t,i=function(e){if("*"===e.text[0]){var n=/^\*(\S+)/.exec(e.text);if(n)return n[1]}}(e);if(i){var a=function(e,n){return En[e]&&Ie(n.authorBusinessCard.getAcc())?En[e]:xn[e]}(i,e);if(a){e.text=(n=e.text,t=RegExp(/(https?)\*Krzywi się\.\*(\S+)/),n.replace(t,"$1:/$2"));var r=e.authorBusinessCard.getNick();return e.receiverBusinessCard&&(r+=" -> "+e.receiverBusinessCard.getNick()),log(h(`[${e.channel}] (${r}): ${e.text}`)),a(e)}}}(n),e.apply(Engine.chatController,arguments)},function(){L("drunkenness","Upojenie alkoholowe","Po wypiciu napojów alkoholowych postać zaczyna coraz bardziej bełkotać.",(()=>{}));var e=localStorage.getItem("nerthus-intoxication-lvl");e&&(vn=parseInt(e)),vn&&(kn=setInterval(bn,1e4));var n=_g;window._g=function(e,t,i){return b.drunkenness?((o=(a=e).match(/^moveitem.*id=(\d+)/))&&a.includes("&st=1")&&(r=Engine.items.getItemById(o[1]))&&16===r.cl&&r.stat.search("lvl=")>-1&&18===parseInt(r.stat.match(/lvl=([0-9]+)/)[1])&&((vn+=10)>100&&(vn=100),localStorage.setItem("nerthus-intoxication-lvl",vn),kn||(kn=setInterval(bn,1e4))),function(e,n){return e.startsWith("chat&channel=local")&&!e.endsWith("&style=me")&&(null==n?void 0:n.c)&&!n.c.startsWith("*")}(e,i)&&(i.c=function(e){if(0===vn||["*/@"].indexOf(e[0])>=0)return e;var n=[];switch(Math.floor(vn/10)){case 10:case 9:e="/lm bełkota coś niezrozumiale.";break;case 8:e=jn(e.split(" ")).join(" ");case 7:for(var t in n=e.split(", "))n[t]=jn(n[t].split(" ")).join(" ");e=n.join(", ");case 6:for(var i in n=e.split(", "))n[i]=jn(n[i].split(" "),1).join(" ");e=n.join(", ");case 5:for(var a in n=e.split(" "))n[a].length>4&&(n[a]=jn(n[a].split("")).join(""));e=n.join(" ");case 4:for(var r in n=e.split(" "))n[r].length>5&&(n[r]=jn(n[r].split("")).join(""));e=n.join(" ");case 3:for(var o in n=e.split(" "))n[o].length>4&&(n[o]=jn(n[o].split(""),1).join(""));e=n.join(" ");case 2:for(var s in n=e.split(" "))n[s].length>5&&(n[s]=jn(n[s].split(""),1).join(""));e=n.join(" ");case 1:e=e.replace(/[.,:?!-]/g," *hik*");break;case 0:e=e.replace(/[.,:?!-]/g,"")}return e}(i.c),i.c.startsWith("/lm ")&&(arguments[0]+="&style=me",i.c=i.c.substring(4))),n(...arguments)):n(...arguments);var a,r,o}}()}function Nn(e,n,t){t?xn[e]=n:En[e]=n}function Cn(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,i=Array(n);t<n;t++)i[t]=e[t];return i}function In(e){return function(e){if(Array.isArray(e))return e}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){if(e){if("string"==typeof e)return Cn(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Cn(e,n):void 0}}(e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var On=["TRADE","GLOBAL"];function Mn(e,n){return new Proxy(e,{get(e,t){return"getNick"===t?()=>n:Reflect.get(...arguments)}})}function Tn(e){e.authorBusinessCard=new Proxy({},{get:()=>()=>""}),e.receiverBusinessCard&&(e.receiverBusinessCard=new Proxy({},{get:()=>()=>""}))}function Dn(e){return e.style="nerthus-nar1",e.nick=e.authorBusinessCard.getNick(),Tn(e),e.text=e.text.replace(/^\*nar1? /,""),e}function Pn(e){e.style="nerthus-dial1",e.nick=e.authorBusinessCard.getNick();var n=In(e.text.split(" ").slice(1).join(" ").split(",")),t=n[0],i=n.slice(1);return e.authorBusinessCard=Mn(e.authorBusinessCard,t),e.text=i.join(","),e}var An={nar:Dn,nar1:Dn,nar2:function(e){return e.style="nerthus-nar2",e.nick=e.authorBusinessCard.getNick(),Tn(e),e.text=e.text.replace(/^\*nar2 /,""),e},nar3:function(e){return e.style="nerthus-nar3",e.nick=e.authorBusinessCard.getNick(),Tn(e),e.text=e.text.replace(/^\*nar3 /,""),e},nar6:function(e){return e.style="nerthus-nar-rainbow",e.nick=e.authorBusinessCard.getNick(),Tn(e),e.text=e.text.replace(/^\*nar6 /,""),e},dial:Pn,dial1:Pn,dial2:function(e){e.style="nerthus-dial2",e.nick=e.authorBusinessCard.getNick();var n=In(e.text.split(" ").slice(1).join(" ").split(",")),t=n[0],i=n.slice(1);return e.authorBusinessCard=Mn(e.authorBusinessCard,t),e.text=i.join(","),e},dial3:function(e){e.style="nerthus-dial3",e.nick=e.authorBusinessCard.getNick();var n=In(e.text.split(" ").slice(1).join(" ").split(",")),t=n[0],i=n.slice(1);return e.authorBusinessCard=Mn(e.authorBusinessCard,t),e.text=i.join(","),e},dial666:function(e){e.style="nerthus-dial666",e.nick=e.authorBusinessCard.getNick();var n=In(e.text.split(" ").slice(1).join(" ").split(",")),t=n[0],i=n.slice(1);return e.authorBusinessCard=Mn(e.authorBusinessCard,t),e.text=i.join(","),e},sys:function(e){return e.style="nerthus-sys",e.nick=e.authorBusinessCard.getNick(),Tn(e),e.text=e.text.replace(/^\*sys /,""),e},map:function(e){e.style="nerthus-command";var n=e.text.split(" ").slice(1).join(" ").split(","),t=h(n[0]),i=parseInt(n[1]);if(i)z(t,2,i);else{if(On.includes(e.channel))return;z(t,1)}k()},resetMap:function(e){return e.style="nerthus-command",v(2,parseInt(e.text.split(" ").slice(1).join(" "))),k(),!1},light:function(e){e.style="nerthus-command";var n=e.text.split(" ");n.shift();var t=n.join(" ").split(",");if(!On.includes(e.channel)||0!==n.length&&t[2]){if(0===n.length)G(-1,"#000");else{var i=t[0].trim(),a=t[1]?t[1].trim():"#000",r=t[2]?t[2].trim():"default";G(1-(i=parseFloat(i.replace(",","."))),a,r)}return H(),!1}},addGraf:function(e){e.style="nerthus-command";var n=e.text.split(" ").slice(1).join(" ").split(","),t=parseInt(n[0]),i=parseInt(n[1]),a=h(n[2]),r=h(n[3]),o=null!=r?r:"",s=parseInt(n[4])>0,c=parseInt(n[5]);if(!On.includes(e.channel)||c)return ge(new be(t,i,a,o,s),c),!1},delGraf:function(e){e.style="nerthus-command";var n=e.text.split(" ")[1].split(","),t=parseInt(n[0]),i=parseInt(n[1]),a=parseInt(n[2]);if(!On.includes(e.channel)||a)return re(t,i,a),!1},hide:function(e){e.style="nerthus-command";var n=e.text.split(" ")[1];return we(parseInt(n)),!1},weather:function(e){e.style="nerthus-command";var n=/^\*weather(?: ([\w-]+)(?:, ?(\d+))?)?/g.exec(e.text);return!!n&&(On.includes(e.channel)?void 0:(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";e&&"reset"!==e?(qe.includes(e)||Te[e])&&(en[n]=e):en[n]=""}(n[1],n[2]),b.weatherEffects&&Je(!0),gn(),!1))}},_n={me:function(e){return e.style=2,e.nick=e.authorBusinessCard.getNick(),Tn(e),e.text=e.text.replace(/^\*me /,""),e},lang:function(e){if(console.log(e),e.text.split(",").length<2)return e;e.style=`nerthus-lang nerthus-lang-ts-${e.ts}`,e.text=e.text.replace(/^\*lang /,"");var n=e.text.split(","),t=n[0].toLowerCase().replace(/[^a-ząćęłńóśźż -]/gi,"");return n.shift(),e.text=`*${n.join(",").trim()}*`,e.tip=t,setTimeout((function(){for(var n=0,i=Array.from(document.querySelectorAll(`.nerthus-lang-ts-${e.ts} .message-part`));n<i.length;n++){var a=i[n];$(a).tip(`Język wiadomości: ${t}`)}}),0),e},nar0:function(e){return e.style="nerthus-nar0",e.nick=e.authorBusinessCard.getNick(),Tn(e),e.text=e.text.replace(/^\*nar0? /,""),e},dial0:function(e){e.style="nerthus-dial0",e.nick=e.authorBusinessCard.getNick();var n=In(e.text.split(" ").slice(1).join(" ").split(",")),t=n[0],i=n.slice(1);return e.authorBusinessCard=Mn(e.authorBusinessCard,t),e.text=i.join(","),e}},Rn=JSON.parse('["Ciułacz","Łowca Wilków","Tropiciel Zulusów","Poganiacz Goblinów","Piętno Orków","Miłośnik Harpii","Rezun Olbrzymów","Hycel Gnolli","Koszmar Tolloków","Magazynier Pełną Gębą","Zguba Minotaurów","Niszczyciel Szkieletów","Treser Centaurów","Nieustraszony Pogromca Korsarzy","Tańczący z Mumiami","Szabrownik Wraków","Gobliński Kat","Postrach Berserkerów","Władca Kazamatów","Młot na Czarownice","Dręczyciel Praorków","Zguba Czarnej Gwardii","Poskramiacz Furboli","Egzekutor Myświórów","Wielki Inkwizytor","Zaklinacz Arachnidów","Kat Demonisa","Oprawca Maddoków","Potomek Najwyższych","Władca Puszczy","Konkwistador","Ewokator Duchów","Odkrywca Reliktów","Smocza Krew","Piekielny Jeźdźca","Ponury Żniwiarz","Gwardzista Piekieł"]'),Un=JSON.parse('{"16":"Teźa","50":"Mulher Má","319":"Niecny drow","513":"Zbieracz gumijagód","1558":"Zielarka","2230":"Mhroczniś","2516":"Misioficer","2720":"Fochnisia","3077":"Siewca Wiatru","4146":"Gumitruskawka","6749":"Przezacna","6901":"Zło wcielone","7422":"Mistrz pióra","9226":"Zadumany","9565":"Donna Amadonna","10222":"Władca Ciemności","10372":"Boski Wiatr","10406":"Latorośle drowa","10430":"Wschodzące Słońce","10473":"Wędrowny Rysownik","10523":"Lux Aeterna","10880":"Boski Wiatr","12002":"Głodny hobbit","12932":"Latorośle drowa","13438":"Zakuty łeb","13931":"Wilcza Zamieć","14615":"Iluzjonista","15098":"Siostra Płomieni","15746":"Miłośniczka kocimiętki","18844":"Doktorek","19984":"Ręka chaosu","20026":"Łagodny Wilczek","22348":"Wampierz","22395":"Marudny Drow","23197":"Szalony Arkanista"}'),Wn=["Kreator","Uber Miszcz Gry","Miszcz Gry","Strażnik Słowa","Tkacz Słów","Trubadur","Piewca Słowa","Radny","Namiestnik"],Ln={NONE:-1,ADM:0,SMG:1,MG:2,MC:3,SMC:4,NARRATOR:5,NARRATOR_MC:6,COUNCILOR:7,NAMIESTNIK:8},Bn={ADM:1,MG:2,SMG:16};function $n(e){var n="",t=function(e){var n,t=Ln.NONE;switch(e.rights&&(t=(n=e.rights)&Bn.ADM?Ln.ADM:n&Bn.SMG?Ln.SMG:n&Bn.MG?Ln.MG:n?Ln.MC:Ln.NONE),Ce(e.account)){case Ne.NARRATOR:t=t===Ln.MC?Ln.NARRATOR_MC:Ln.NARRATOR;break;case Ne.COUNCILOR:t=Ln.COUNCILOR;break;case Ne.NAMIESTNIK:t=Ln.NAMIESTNIK}return t===Ln.NONE?"":Wn[t]}(e.d);return t&&(n+='<div class="rank">'+t+"</div>"),e.d.guest&&(n+='<div class="rank">'+_t("deputy")+"</div>"),n+='<div class="info-wrapper"><div class="nick">'+e.d.nick+"</div>"+(e.d.prof?'<div class="profs-icon '+e.d.prof+'"></div>':"")+"</div>",1===parseInt(e.wanted)&&(n+="<div class=wanted></div>"),e.d.clan&&(n+='<div class="clan-in-tip">['+e.d.clan.name+"]</div>"),n+='<div class="clan-in-tip">'+function(e){return Un[parseInt(e.id)]||(e.lvl?Rn[Math.min(Rn.length-1,parseInt(e.lvl)-1>>3)]:"")}(e.d)+"</div>",n+=function(e){var n="",t=e.d.is_blessed?'<div class="bless"></div>':"",i=1&e.d.attr?'<div class="mute"></div>':"",a="1"===e.d.vip?'<div class="k-b"></div>':"",r=2&e.d.attr?'<div class="warn"></div>':"",o=e.d.clan?'<div class="line"></div>':"",s=e.d.wanted?'<div class="wanted-i"></div>':"";return""===t&&""===i&&""===a&&""===r&&""===s||(n=`<div class="buffs-wrapper">${o}${s}${t}${i}${a}${r}</div>`),n}(e),n}var Zn,Gn=JSON.parse('{"aries":["Baran - Czerpanie mocy z czystej agresji wprawdzie wzmacnia magię ofensywną lecz destabilizuje pozostałe szkoły. Tworzenie portali staje się zbyt niebezpieczne.","Podstawowe zaklęcia zniszczenia nie wymagają energii maga, jednak przemiana jest zupełnie zablokowana."],"taurus":["Byk - Stałość, rzeczowość i skupienie ułatwiają snucie wysoce skomplikowanych czarów.","Pozwala tworzyć magazyny energii na dowolnym poziomie zaklinania. Ich siła jest zależna od posiadanego poziomu tej szkoły."],"gemini":["Bliźnięta - Wszechstronna wiedza, obiektywizm i niezakłócona emocjami racjonalność, pozwalają skuteczniej przeciwstawiać się sile innych magów.","Odrzucenie wzrasta o jeden poziom, lecz nie wyżej niż 4/5 (arcymistrz zyskuje możliwość spętania mocy innego arcymistrza)."],"cancer":["Rak - Instynkt i ciekawość sprzyjają zgłębianiu myśli innych oraz mechanik świata. Skupienie się na sprawach odległych naraża maga na niebezpieczeństwa.","Myśli innych można czytać na poziomie 4/5 poznania. W zamian zablokowane jest odrzucenie."],"leo":["Lew - Stanowczość i autorytet pozwalają działać na wielką skalę, jednakże towarzysząca temu duma sprawia, iż przedsięwzięcia te są nieco przyziemne.","Najsłabsza szkoła zostaje wzmocniona o jeden poziom, jednak możliwe jest korzystanie wyłącznie z elementów niższych. Brak efektu, jeżeli mag takowych nie posiada."],"virgo":["Panna - Czysta wręcz troska oraz pedantyczność stanowią idealną podstawę do pomocy zagrożonym życiom.","Dodatkowe przywrócenie 3/5 jednego organizmu żywego dziennie. W zamian zablokowane jest zniszczenie."],"libra":["Waga - Ułatwione jest wyważenie zaklęć z użyciem ich pierwotnej mocy, która zostaje ustabilizowana.","Zaklęcia na poziomie adepta przemiany nie wymagają energii, jednak zablokowane jest użycie elementów niższych."],"scorpio":["Skorpion - Ewokacja pozwala z łatwością sięgnąć po istoty, które dotychczas znajdowały się na granicy możliwości maga. Zgłębienie ich tajemnic ma jednak swój koszt.","Przywołanie zwiększone jest o jeden poziom, lecz nie wyżej niż 4/5. Zablokowane zostają elementy natury i równowagi."],"sagittarius":["Strzelec -  Entuzjazm, otwartość oraz szczerość znacząco ułatwiają współpracę z innymi.","Umożliwia współpracę z magami posługującymi się innymi szkołami. Jeżeli posiadany jest już atrybut teoria magiczna, to podczas kooperacji zaklęcie maga z kosmosem wzrasta o jeden stopień, lecz nie wyżej niż na poziom 4/5."],"capricorn":["Koziorożec - Wytrwałe, zdyscyplinowane oraz ambitne dążenie do celu wprost prowadzą do czystego profesjonalizmu.","Najlepiej rozwinięta szkoła, podniesiona zostaje o jeden poziom, lecz nie wyżej niż na poziom mistrza. W zamian reszta szkół spada o jeden poziom (lub w przypadku poziomu 1/5 zostaje zablokowana). Jeżeli mag posiada już jedną szkołę na poziomie 4/5 lub wyżej, to podniesiona zostaje następna najlepsza szkoła. W razie więcej niż jednej szkoły spełniającej wymogi, gracz dokonuje wyboru."],"aquarius":["Wodnik - Wynalazczość, niezależność oraz przekraczanie granic pozwalają zasmakować umiejętności, które dotychczas były niedostępne, aż do zatracenia.","Szkoła z najwyższym poziomem zostaje zablokowana. Najsłabsza szkoła uzyskuje jej poziom. Brak efektu w przypadku szkół o równym poziomie bądź braku jednej, najsilniejszej szkoły."],"pisces":["Ryby - Ucieczka od rzeczywistości w iluzje, które stają się sztuką, znacząco wzmacniają możliwości maga. Jednakże złożoność wyobrażeń uniemożliwia kooperację z innymi.","Podstawowe iluzje nie zużywają energii. Zablokowane korzystanie z atrybutu teoria magiczna."]}'),Fn=[["capricorn",19],["aquarius",18],["pisces",20],["aries",19],["taurus",22],["gemini",21],["cancer",22],["leo",23],["virgo",22],["libra",22],["scorpio",21],["sagittarius",21],["capricorn",0]];function Kn(){var e,t,r;window.nerthus={loaded:!1,addCallbackToEvent(e,n){wn[e]||(wn[e]=[]),wn[e].push(n)},permissions:{checkPermissionLvl:Ce,hasNarrationRights:Ie},weather:{getWeather:mn},night:{changeLight:K,applyCurrentNight:H,turnLightsOn:O},npcList:ke,npc:{npcList:ke,addNpc:me,addNpcToList:ge,hideGameNpc:we,loadNpcsFromFile:Ee},map:{addToMapChangelist:z,removeFromMapChangelist:v,applyCurrentMapChange:k}},window.nerthus.addCallbackToEvent("loaded",(function(){window.nerthus.loaded=!0})),$('<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/nerthus-margonem/nerthusaddon@5.8.0/res/css/style.css">').appendTo("head"),function(){if(localStorage.nerthus_options){var e=JSON.parse(localStorage.nerthus_options);for(var n in e)b[n]=e[n]}}(),e=Engine.others.getDrawableList,Engine.others.getDrawableList=function(){var n=e();for(var t in n)n[t].isPlayer&&(n[t].tip[0]=$n(n[t]));return n},Engine.hero.createStrTip=function(){return $n(Engine.hero)},Engine.hero.tip[0]=Engine.hero.createStrTip(),function(){n=Engine.map.d.id;var e=Engine.map.hideLoaderSplash;Engine.map.hideLoaderSplash=function(){Engine.map.d.id!==n&&function(){for(var e in n=Engine.map.d.id,i)i[e][0](i[e][1])}(),e.call(Engine.map)}}(),r=Engine.map.draw,Engine.map.draw=function(e){r.call(Engine.map,e),y.complete&&0!==y.naturalWidth&&(e.drawImage(y,0-Engine.map.offset[0],0-Engine.map.offset[1]),Engine.map.goMark&&Engine.map.drawGoMark(e))},a(k),xe(),a(I),a(H),L("night","Pory dnia i nocy","Ściemnianie mapy w zależności od pory dnia.",H),t=$(".layer.interface-layer"),Oe=$('<div id="nerthus-widgets-container"></div>').appendTo(t),yn(),function(){var e,n,t=new Date,i=(e=t.getUTCDate(),n=t.getUTCMonth(),e>Fn[n][1]?Fn[n+1][0]:Fn[n][0]),a=De(0,"https://cdn.jsdelivr.net/gh/nerthus-margonem/nerthusaddon@5.8.0/res/img/zodiac/"+i+".png",Gn[i][0]);a.children(".nerthus__widget-image").css("cursor","pointer").click((function(){var e=a.children(".nerthus__widget-desc");e.text()===Gn[i][0]?e.text(Gn[i][1]):e.text(Gn[i][0])})),b.zodiac?a.css("display","flex"):a.css("display","none"),L("zodiac","Widget znaku zodiaku","Pokazuje lub ukrywa widget w lewym górnym rogu mapy.",(function(){b.zodiac?a.css("display","flex"):a.css("display","none")}))}(),function(){for(var e in An)Nn(e,An[e],!1);for(var n in _n)Nn(n,_n[n],!0)}(),Sn(),function(){var e=function(){Engine.widgetManager.addKeyToDefaultWidgetSet("nerthus",D[0],D[1],"Nerthus","green",U)};$("head").append("<style>.main-buttons-container .widget-button .icon.nerthus {background-image: url(https://cdn.jsdelivr.net/gh/nerthus-margonem/nerthusaddon@5.8.0/res/img/widget-icon.gif);background-position: 0;}</style>");var n=Engine.widgetManager.addWidgetButtons;Engine.widgetManager.addWidgetButtons=function(t){n.call(Engine.widgetManager,t),e(),W(),Engine.widgetManager.addWidgetButtons=n},Engine.interfaceStart&&(e(),W())}(),zn("loaded")}if(null!==(Zn=Engine)&&void 0!==Zn&&null!==(Zn=Zn.map)&&void 0!==Zn&&null!==(Zn=Zn.d)&&void 0!==Zn&&Zn.id)Kn();else{var Hn=Engine.hero.updateCollider;Engine.hero.updateCollider=function(){Hn.call(Engine.hero),Engine.map.imgLoaded&&(Engine.hero.updateCollider=Hn,Kn())}}}()}();